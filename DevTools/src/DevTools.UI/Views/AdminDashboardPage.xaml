<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="DevTools.UI.Views.AdminDashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:DevTools.UI.Views"
    xmlns:cv="using:DevTools.UI.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    x:Name="AdminPage">

    <Page.Resources>
        <cv:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
        <cv:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <cv:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
        <cv:ObjectToVisibilityConverter x:Key="ObjectToVisibilityConverter"/>
        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,10,0,5"/>
        </Style>
        <Style x:Key="ErrorMessageStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="Red"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="Margin" Value="0,5"/>
        </Style>
    </Page.Resources>

    <Grid>
        <ProgressRing IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}" Width="50" Height="50"/>

        <ScrollViewer Padding="20">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0">
                    <TextBlock Text="Admin Dashboard" FontSize="28" FontWeight="Bold" Margin="0,0,0,10"/>
                    <TextBlock Text="{x:Bind ViewModel.ErrorMessage, Mode=OneWay}" 
                               Style="{StaticResource ErrorMessageStyle}" 
                               Visibility="{x:Bind ViewModel.ErrorMessage, Mode=OneWay, Converter={StaticResource StringToVisibilityConverter}}"/>
                </StackPanel>

                <Grid Grid.Row="1" Margin="0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Border Grid.Column="0" BorderBrush="{ThemeResource SystemControlForegroundBaseMediumBrush}" BorderThickness="1" Margin="0,0,10,0" Padding="15">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Text="Tool Management" Style="{StaticResource SectionHeaderStyle}"/>

                            <StackPanel Grid.Row="1" Margin="0,10">
                                <TextBox Header="Tool Name" PlaceholderText="Enter tool name" Text="{x:Bind ViewModel.ToolName, Mode=TwoWay}" Margin="0,5"/>
                                <TextBox Header="Description" PlaceholderText="Enter tool description" Text="{x:Bind ViewModel.ToolDescription, Mode=TwoWay}" 
                                         AcceptsReturn="True" TextWrapping="Wrap" Height="80" Margin="0,5"/>

                                <ComboBox Header="Tool Group" 
                                          ItemsSource="{x:Bind ViewModel.Groups, Mode=OneWay}" 
                                          SelectedValuePath="Id"
                                          SelectedValue="{x:Bind ViewModel.SelectedGroupId, Mode=TwoWay, FallbackValue=0}"
                                          DisplayMemberPath="Name"
                                          PlaceholderText="Select a group"
                                          HorizontalAlignment="Stretch"
                                          Margin="0,5"/>

                                <StackPanel Orientation="Horizontal" Margin="0,5">
                                    <CheckBox Content="Premium Tool" IsChecked="{x:Bind ViewModel.IsPremium, Mode=TwoWay}" Margin="0,0,20,0"/>
                                    <CheckBox Content="Enabled" IsChecked="{x:Bind ViewModel.IsEnabled, Mode=TwoWay}"/>
                                </StackPanel>

                                <Button Content="Upload .dll file" Margin="0,5" Click="OnSelectFileClick"/>
                                <TextBlock Text="{x:Bind ViewModel.ToolFile.Name, Mode=OneWay, FallbackValue='No file selected'}" 
                                           Margin="0,2" Opacity="0.8"/>

                                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                    <Button Content="Add Tool" Command="{x:Bind ViewModel.AddToolCommand}" 
                                            Style="{ThemeResource AccentButtonStyle}" Margin="0,0,10,0"/>
                                    <Button Content="Update Tool" Command="{x:Bind ViewModel.UpdateToolCommand}" Margin="0,0,10,0"/>
                                    <Button Content="Clear Form" Click="OnClearFormClick"/>
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <Border Grid.Column="1" BorderBrush="{ThemeResource SystemControlForegroundBaseMediumBrush}" BorderThickness="1" Margin="10,0,0,0" Padding="15">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Text="Group Management" Style="{StaticResource SectionHeaderStyle}"/>

                            <StackPanel Grid.Row="1" Margin="0,10">
                                <TextBlock Text="Selected Group: " 
                                           FontWeight="SemiBold" 
                                           Visibility="{x:Bind ViewModel.SelectedGroup, Mode=OneWay, Converter={StaticResource ObjectToVisibilityConverter}}"/>
                                <TextBlock Text="{x:Bind ViewModel.SelectedGroup.Name, Mode=OneWay, FallbackValue=''}" 
                                           Visibility="{x:Bind ViewModel.SelectedGroup, Mode=OneWay, Converter={StaticResource ObjectToVisibilityConverter}}"
                                           Margin="0,0,0,10"/>

                                <TextBox Header="Group Name" PlaceholderText="Enter group name" Text="{x:Bind ViewModel.GroupName, Mode=TwoWay}" Margin="0,5"/>
                                <TextBox Header="Description" PlaceholderText="Enter group description" Text="{x:Bind ViewModel.GroupDescription, Mode=TwoWay}" 
                                         AcceptsReturn="True" TextWrapping="Wrap" Height="80" Margin="0,5"/>

                                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                    <Button Content="Add Group" Command="{x:Bind ViewModel.AddGroupCommand}" 
                                            Style="{ThemeResource AccentButtonStyle}" Margin="0,0,10,0"/>
                                    <Button Content="Update Group" Command="{x:Bind ViewModel.UpdateGroupCommand}" Margin="0,0,10,0"/>
                                    <Button Content="Clear Form" Click="OnClearFormClick"/>
                                </StackPanel>
                            </StackPanel>

                            <ListView Grid.Row="2" 
                                      Margin="0,15,0,0"
                                      ItemsSource="{x:Bind ViewModel.Groups, Mode=OneWay}"
                                      SelectionMode="Single"
                                      SelectionChanged="OnGroupSelectionChanged">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,5">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="{Binding Name}" VerticalAlignment="Center"/>
                                            <Button Grid.Column="1" 
                                                    Content="Delete" 
                                                    CommandParameter="{Binding}"
                                                    Command="{Binding ElementName=AdminPage, Path=ViewModel.DeleteGroupCommand}"/>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </Grid>
                    </Border>
                </Grid>

                <Grid Grid.Row="2" Margin="0,10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="Tools" Style="{StaticResource SectionHeaderStyle}"/>

                    <ListView Grid.Row="1" 
                              ItemsSource="{x:Bind ViewModel.Tools, Mode=OneWay}"
                              SelectionMode="Single"
                              SelectionChanged="OnToolSelectionChanged">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="10" BorderThickness="0,0,0,1" BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>


                                    <StackPanel Grid.Column="0">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                                            <TextBlock Text=" (Premium)" 
                                                       Foreground="#FFD700" 
                                                       Visibility="{Binding IsPremium, Converter={StaticResource BoolToVisibilityConverter}}" 
                                                       FontSize="12" 
                                                       VerticalAlignment="Center"/>
                                            <TextBlock Text=" (Disabled)" 
                                                       Foreground="Red" 
                                                       Visibility="{Binding IsEnabled, Converter={StaticResource InverseBoolToVisibilityConverter}}" 
                                                       FontSize="12" 
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <TextBlock Text="{Binding GroupName}" TextTrimming="CharacterEllipsis" Opacity="0.7"/>
                                        <TextBlock Text="{Binding Description}" FontStyle="Italic" FontSize="12" Opacity="0.6"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                                        <Button Content="Edit" 
                                                Margin="5,0"
                                                Click="OnEditToolClick"
                                                CommandParameter="{Binding}"/>

                                        <Button Content="Enable" 
                                                Margin="5,0"
                                                CommandParameter="{Binding}"
                                                Command="{Binding ElementName=AdminPage, Path=ViewModel.EnableToolCommand}"
                                                Visibility="{Binding IsEnabled, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>

                                        <Button Content="Disable" 
                                                Margin="5,0"
                                                CommandParameter="{Binding}"
                                                Command="{Binding ElementName=AdminPage, Path=ViewModel.DisableToolCommand}"
                                                Visibility="{Binding IsEnabled, Converter={StaticResource BoolToVisibilityConverter}}"/>

                                        <Button Content="Set Premium" 
                                                Margin="5,0"
                                                CommandParameter="{Binding}"
                                                Command="{Binding ElementName=AdminPage, Path=ViewModel.SetPremiumCommand}"
                                                Visibility="{Binding IsPremium, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>

                                        <Button Content="Set Free" 
                                                Margin="5,0"
                                                CommandParameter="{Binding}"
                                                Command="{Binding ElementName=AdminPage, Path=ViewModel.SetFreeCommand}"
                                                Visibility="{Binding IsPremium, Converter={StaticResource BoolToVisibilityConverter}}"/>

                                        <Button Content="Delete" 
                                                Margin="5,0"
                                                CommandParameter="{Binding}"
                                                Command="{Binding ElementName=AdminPage, Path=ViewModel.DeleteToolCommand}"/>
                                    </StackPanel>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>
            </Grid>
        </ScrollViewer>
    </Grid>
</Page>